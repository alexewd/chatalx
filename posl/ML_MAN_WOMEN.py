import pandas as pd
import numpy as np
import seaborn as sns
import matplotlib.pyplot as plt
from scipy import stats

# Загрузка данных из CSV
df = pd.read_csv('e:/posl/data/weight-height.csv')

# Описательная статистика
desc_stats = df.describe()
print("Описательная статистика:\n", desc_stats)

# Проверка нормальности для роста и веса (тест Шапиро-Уилка)
shapiro_height_men = stats.shapiro(df[df['Gender'] == 'Male']['Height'])
shapiro_height_women = stats.shapiro(df[df['Gender'] == 'Female']['Height'])

shapiro_weight_men = stats.shapiro(df[df['Gender'] == 'Male']['Weight'])
shapiro_weight_women = stats.shapiro(df[df['Gender'] == 'Female']['Weight'])

print("\nРезультаты теста Шапиро-Уилка для нормальности:")
print(f"Для мужчин (Рост): p-значение = {shapiro_height_men.pvalue}")
print(f"Для женщин (Рост): p-значение = {shapiro_height_women.pvalue}")
print(f"Для мужчин (Вес): p-значение = {shapiro_weight_men.pvalue}")
print(f"Для женщин (Вес): p-значение = {shapiro_weight_women.pvalue}")

# t-тест для проверки различий между мужчинами и женщинами по росту и весу
t_test_height = stats.ttest_ind(df[df['Gender'] == 'Male']['Height'], df[df['Gender'] == 'Female']['Height'])
t_test_weight = stats.ttest_ind(df[df['Gender'] == 'Male']['Weight'], df[df['Gender'] == 'Female']['Weight'])

print("\nРезультаты t-теста для различий между мужчинами и женщинами:")
print(f"t-тест для роста: t-статистика = {t_test_height.statistic}, p-значение = {t_test_height.pvalue}")
print(f"t-тест для веса: t-статистика = {t_test_weight.statistic}, p-значение = {t_test_weight.pvalue}")

# Корреляция между ростом и весом для каждого пола
corr_height_weight_men = df[df['Gender'] == 'Male'][['Height', 'Weight']].corr()
corr_height_weight_women = df[df['Gender'] == 'Female'][['Height', 'Weight']].corr()

print("\nКорреляция между ростом и весом для мужчин:")
print(corr_height_weight_men)
print("\nКорреляция между ростом и весом для женщин:")
print(corr_height_weight_women)

# Визуализация: Бокс-плоты для роста и веса по полу
plt.figure(figsize=(12, 6))

# Бокс-плот для роста
plt.subplot(1, 2, 1)
sns.boxplot(x='Gender', y='Height', data=df)
plt.title('Распределение роста по полу')
plt.ylabel('Рост (дюймы)')

# Бокс-плот для веса
plt.subplot(1, 2, 2)
sns.boxplot(x='Gender', y='Weight', data=df)
plt.title('Распределение веса по полу')
plt.ylabel('Вес (фунты)')

plt.tight_layout()
plt.show()

# Точечная диаграмма (scatter plot) для роста и веса
plt.figure(figsize=(8, 6))
sns.scatterplot(x='Height', y='Weight', hue='Gender', data=df, palette='Set1')
plt.title('Взаимосвязь между ростом и весом')
plt.xlabel('Рост (дюймы)')
plt.ylabel('Вес (фунты)')
plt.legend(title='Пол')
plt.show()

# Анализ выводов:
print("\n--- Анализ результатов ---")

# 1. Проверка нормальности:
print("\n1. Проверка нормальности распределений:")
if shapiro_height_men.pvalue < 0.05:
    print("   Распределение роста мужчин отклоняется от нормального.")
else:
    print("   Распределение роста мужчин нормально.")
    
if shapiro_height_women.pvalue < 0.05:
    print("   Распределение роста женщин отклоняется от нормального.")
else:
    print("   Распределение роста женщин нормально.")
    
if shapiro_weight_men.pvalue < 0.05:
    print("   Распределение веса мужчин отклоняется от нормального.")
else:
    print("   Распределение веса мужчин нормально.")
    
if shapiro_weight_women.pvalue < 0.05:
    print("   Распределение веса женщин отклоняется от нормального.")
else:
    print("   Распределение веса женщин нормально.")

# 2. t-тест:
print("\n2. t-тест для различий между мужчинами и женщинами:")
if t_test_height.pvalue < 0.05:
    print("   Средний рост мужчин и женщин статистически различается.")
else:
    print("   Средний рост мужчин и женщин не различается статистически.")

if t_test_weight.pvalue < 0.05:
    print("   Средний вес мужчин и женщин статистически различается.")
else:
    print("   Средний вес мужчин и женщин не различается статистически.")

# 3. Корреляция:
print("\n3. Корреляция между ростом и весом:")
print("   Для мужчин корреляция между ростом и весом:", corr_height_weight_men.iloc[0, 1])
print("   Для женщин корреляция между ростом и весом:", corr_height_weight_women.iloc[0, 1])
#######################
print('Если данные не нормальны')

mannwhitney_height = stats.mannwhitneyu(df[df['Gender'] == 'Male']['Height'], df[df['Gender'] == 'Female']['Height'])
mannwhitney_weight = stats.mannwhitneyu(df[df['Gender'] == 'Male']['Weight'], df[df['Gender'] == 'Female']['Weight'])
print(f"Тест Манна-Уитни для роста: p-значение = {mannwhitney_height.pvalue}")
print(f"Тест Манна-Уитни для веса: p-значение = {mannwhitney_weight.pvalue}")

spearman_corr_men = stats.spearmanr(df[df['Gender'] == 'Male']['Height'], df[df['Gender'] == 'Male']['Weight'])
spearman_corr_women = stats.spearmanr(df[df['Gender'] == 'Female']['Height'], df[df['Gender'] == 'Female']['Weight'])
print(f"Корреляция Спирмена для мужчин: {spearman_corr_men.correlation}")
print(f"Корреляция Спирмена для женщин: {spearman_corr_women.correlation}")
###########################
# Если данные не нормально распределены, то для проверки гипотез следует использовать непараметрические методы. Эти методы не требуют предположений о нормальности распределений. Вот что можно сделать в таких случаях:

# Когда данные не нормально распределены:
# Для проверки различий между группами:

# Вместо t-теста можно использовать непараметрический аналог t-теста, который называется тест Манна-Уитни (Mann-Whitney U test). Этот тест проверяет, различаются ли медианы двух групп, и может быть использован, когда распределение не является нормальным.
# Например:

# python
# Copy
# Edit
# mannwhitney_height = stats.mannwhitneyu(df[df['Gender'] == 'Male']['Height'], df[df['Gender'] == 'Female']['Height'])
# mannwhitney_weight = stats.mannwhitneyu(df[df['Gender'] == 'Male']['Weight'], df[df['Gender'] == 'Female']['Weight'])
# print(f"Тест Манна-Уитни для роста: p-значение = {mannwhitney_height.pvalue}")
# print(f"Тест Манна-Уитни для веса: p-значение = {mannwhitney_weight.pvalue}")
# Для проверки связи между переменными:

# Если данные не нормальны, можно использовать коэффициент корреляции Спирмена (Spearman's rank correlation), который не зависит от нормальности данных.
# Пример:

# python
# Copy
# Edit
# spearman_corr_men = stats.spearmanr(df[df['Gender'] == 'Male']['Height'], df[df['Gender'] == 'Male']['Weight'])
# spearman_corr_women = stats.spearmanr(df[df['Gender'] == 'Female']['Height'], df[df['Gender'] == 'Female']['Weight'])
# print(f"Корреляция Спирмена для мужчин: {spearman_corr_men.correlation}")
# print(f"Корреляция Спирмена для женщин: {spearman_corr_women.correlation}")
# Теперь давайте обсудим, как делаются выводы по гипотезам, опираясь на результаты статистических тестов:

# Выводы по гипотезам:
# Когда мы выполняем статистические тесты, мы обычно проверяем две гипотезы:

# Нулевая гипотеза (H0) — это гипотеза, которая предполагает отсутствие эффекта или различий между группами/переменными. Например:
# "Средний рост мужчин и женщин не различается" (для t-теста).
# "Между ростом и весом нет связи" (для теста корреляции).
# Альтернативная гипотеза (H1) — это гипотеза, которая предполагает, что эффект или различие существует. Например:
# "Средний рост мужчин и женщин различается."
# "Между ростом и весом есть значимая связь."
# После выполнения статистического теста мы получаем p-значение, которое помогает принять решение:

# Если p-значение < 0.05, это означает, что результат статистически значим, и мы отклоняем нулевую гипотезу в пользу альтернативной гипотезы. Это свидетельствует о наличии различий или связи.
# Если p-значение ≥ 0.05, это означает, что результат не является статистически значимым, и мы не можем отклонить нулевую гипотезу. То есть, оснований утверждать, что различие или связь существуют, нет.
# Примеры выводов по гипотезам из результатов тестов:
# t-тест для роста:

# Нулевая гипотеза (H0): Средний рост мужчин и женщин одинаков.
# Альтернативная гипотеза (H1): Средний рост мужчин и женщин различается.
# p-значение = 0.0: Мы отклоняем нулевую гипотезу (p < 0.05), и можем утверждать, что средний рост мужчин и женщин статистически значимо различается.
# t-тест для веса:

# Нулевая гипотеза (H0): Средний вес мужчин и женщин одинаков.
# Альтернативная гипотеза (H1): Средний вес мужчин и женщин различается.
# p-значение = 0.0: Мы отклоняем нулевую гипотезу (p < 0.05), и можем утверждать, что средний вес мужчин и женщин статистически значимо различается.
# Корреляция между ростом и весом:

# Нулевая гипотеза (H0): Нет связи между ростом и весом.
# Альтернативная гипотеза (H1): Существует связь между ростом и весом.
# Корреляция для мужчин = 0.863, Корреляция для женщин = 0.850: Поскольку обе корреляции высокие и значимые (положительные), мы отклоняем нулевую гипотезу и можем утверждать, что существует сильная положительная связь между ростом и весом как у мужчин, так и у женщин.
# Дополнительные примечания:
# Если p-значение теста меньше 0.05, мы всегда отклоняем нулевую гипотезу.
# Если p-значение больше 0.05, мы не отклоняем нулевую гипотезу, но это не означает, что гипотеза верна. Просто мы не нашли достаточно доказательств для ее отклонения.
# Заключение:
# Выводы по гипотезам строятся на основе p-значения:

# Если p < 0.05, мы отвергаем нулевую гипотезу.
# Если p ≥ 0.05, мы не отвергаем нулевую гипотезу.
# В вашем случае, так как p-значения для t-тестов были очень маленькими, мы отклонили нулевые гипотезы и пришли к выводу, что средний рост и вес мужчин и женщин различаются.








# You said:
# Если данные не нормальны
# Тест Манна-Уитни для роста: p-значение = 0.0
# Тест Манна-Уитни для веса: p-значение = 0.0
# Корреляция Спирмена для мужчин: 0.8485589833503592
# Корреляция Спирмена для женщин: 0.8364885471875417
# ChatGPT said:
# ChatGPT
# Отлично! Теперь, когда мы рассматриваем ненормальные данные, результаты теста Манна-Уитни и коэффициенты корреляции Спирмена дают нам следующую информацию:

# 1. Результаты теста Манна-Уитни:
# Тест Манна-Уитни для роста: p-значение = 0.0.
# Тест Манна-Уитни для веса: p-значение = 0.0.
# Выводы:

# Поскольку p-значение для обоих тестов меньше 0.05, мы отклоняем нулевую гипотезу в обоих случаях. Это означает, что существует статистически значимое различие между мужчинами и женщинами как по росту, так и по весу, даже если данные не имеют нормального распределения.
# Интерпретация:

# Тест Манна-Уитни является непараметрическим аналогом t-теста, который используется для проверки различий между медианами двух независимых групп. В данном случае, он указывает на то, что медианы роста и веса мужчин и женщин различаются.
# 2. Корреляция Спирмена:
# Корреляция Спирмена для мужчин: 0.8486.
# Корреляция Спирмена для женщин: 0.8365.
# Выводы:

# Коэффициент корреляции Спирмена измеряет степень монотонной связи между переменными. Поскольку корреляция как для мужчин, так и для женщин достаточно высокая (около 0.85), это указывает на сильную положительную связь между ростом и весом в обеих группах.
# Значения корреляции Спирмена близки к 1, что говорит о том, что между ростом и весом существует сильная взаимосвязь, которая одинаково выражена как у мужчин, так и у женщин, несмотря на то, что данные могут быть не нормально распределены.
# Как интерпретировать результаты при ненормальных данных:
# Тест Манна-Уитни: Мы по-прежнему получаем значительные различия между группами, что подтверждает, что мужчины и женщины отличаются по росту и весу, даже если данные не нормальны.
# Корреляция Спирмена: Мы можем утверждать, что существует сильная связь между ростом и весом в обеих группах, несмотря на то, что распределение данных не нормальное.
# Заключение:
# Тест Манна-Уитни показывает, что различия между мужчинами и женщинами по росту и весу статистически значимы.
# Корреляция Спирмена указывает на сильную положительную связь между ростом и весом как у мужчин, так и у женщин.
# Эти результаты подтверждают, что даже при ненормальном распределении данных, можно провести успешный статистический анализ с использованием непараметрических методов.












