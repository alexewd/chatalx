import pandas as pd
import numpy as np
import seaborn as sns
import matplotlib.pyplot as plt
from scipy import stats

# Загрузка данных из CSV
df = pd.read_csv('e:/posl/data/weight-height.csv')

# Описательная статистика
desc_stats = df.describe()
print("Описательная статистика:\n", desc_stats)

# Проверка нормальности для роста и веса (тест Шапиро-Уилка)
shapiro_height_men = stats.shapiro(df[df['Gender'] == 'Male']['Height'])
shapiro_height_women = stats.shapiro(df[df['Gender'] == 'Female']['Height'])

shapiro_weight_men = stats.shapiro(df[df['Gender'] == 'Male']['Weight'])
shapiro_weight_women = stats.shapiro(df[df['Gender'] == 'Female']['Weight'])

print("\nРезультаты теста Шапиро-Уилка для нормальности:")
print(f"Для мужчин (Рост): p-значение = {shapiro_height_men.pvalue}")
print(f"Для женщин (Рост): p-значение = {shapiro_height_women.pvalue}")
print(f"Для мужчин (Вес): p-значение = {shapiro_weight_men.pvalue}")
print(f"Для женщин (Вес): p-значение = {shapiro_weight_women.pvalue}")

# t-тест для проверки различий между мужчинами и женщинами по росту и весу
t_test_height = stats.ttest_ind(df[df['Gender'] == 'Male']['Height'], df[df['Gender'] == 'Female']['Height'])
t_test_weight = stats.ttest_ind(df[df['Gender'] == 'Male']['Weight'], df[df['Gender'] == 'Female']['Weight'])

print("\nРезультаты t-теста для различий между мужчинами и женщинами:")
print(f"t-тест для роста: t-статистика = {t_test_height.statistic}, p-значение = {t_test_height.pvalue}")
print(f"t-тест для веса: t-статистика = {t_test_weight.statistic}, p-значение = {t_test_weight.pvalue}")

# Корреляция между ростом и весом для каждого пола
corr_height_weight_men = df[df['Gender'] == 'Male'][['Height', 'Weight']].corr()
corr_height_weight_women = df[df['Gender'] == 'Female'][['Height', 'Weight']].corr()

print("\nКорреляция между ростом и весом для мужчин:")
print(corr_height_weight_men)
print("\nКорреляция между ростом и весом для женщин:")
print(corr_height_weight_women)

# Визуализация
sns.boxplot(x='Gender', y='Height', data=df)
sns.boxplot(x='Gender', y='Weight', data=df)

sns.scatterplot(x='Height', y='Weight', hue='Gender', data=df)

plt.show()

# Анализ выводов:
print("\n--- Анализ результатов ---")

# 1. Проверка нормальности:
print("\n1. Проверка нормальности распределений:")
if shapiro_height_men.pvalue < 0.05:
    print("   Распределение роста мужчин отклоняется от нормального.")
else:
    print("   Распределение роста мужчин нормально.")
    
if shapiro_height_women.pvalue < 0.05:
    print("   Распределение роста женщин отклоняется от нормального.")
else:
    print("   Распределение роста женщин нормально.")
    
if shapiro_weight_men.pvalue < 0.05:
    print("   Распределение веса мужчин отклоняется от нормального.")
else:
    print("   Распределение веса мужчин нормально.")
    
if shapiro_weight_women.pvalue < 0.05:
    print("   Распределение веса женщин отклоняется от нормального.")
else:
    print("   Распределение веса женщин нормально.")

# 2. t-тест:
print("\n2. t-тест для различий между мужчинами и женщинами:")
if t_test_height.pvalue < 0.05:
    print("   Средний рост мужчин и женщин статистически различается.")
else:
    print("   Средний рост мужчин и женщин не различается статистически.")

if t_test_weight.pvalue < 0.05:
    print("   Средний вес мужчин и женщин статистически различается.")
else:
    print("   Средний вес мужчин и женщин не различается статистически.")

# 3. Корреляция:
print("\n3. Корреляция между ростом и весом:")
print("   Для мужчин корреляция между ростом и весом:", corr_height_weight_men.iloc[0, 1])
print("   Для женщин корреляция между ростом и весом:", corr_height_weight_women.iloc[0, 1])
#########################################

# Отлично, вы получили результаты статистических тестов, и теперь мы можем их проанализировать и интерпретировать.

# Анализ результатов:
# 1. Результаты теста Шапиро-Уилка для нормальности:
# Для мужчин (Рост): p-значение = 0.140 (больше 0.05). Это говорит о том, что распределение роста мужчин не отклоняется от нормального, то есть данные можно считать нормально распределенными.
# Для женщин (Рост): p-значение = 0.902 (больше 0.05). Аналогично, распределение роста женщин также нормально.
# Для мужчин (Вес): p-значение = 0.383 (больше 0.05). Это означает, что распределение веса мужчин не отклоняется от нормального.
# Для женщин (Вес): p-значение = 0.913 (больше 0.05). И вес женщин также нормально распределен.
# Вывод: Распределения роста и веса как у мужчин, так и у женщин не отклоняются от нормального распределения, что позволяет применять классические статистические методы для дальнейшего анализа.

# 2. Результаты t-теста для различий между мужчинами и женщинами:
# t-тест для роста: t-статистика = 95.60, p-значение = 0.0. Это очень маленькое p-значение (<0.05), что указывает на то, что средний рост мужчин и женщин статистически значимо различается.
# t-тест для веса: t-статистика = 131.82, p-значение = 0.0. Подобным образом, очень низкое p-значение говорит о том, что средний вес мужчин и женщин также статистически значимо различается.
# Вывод: По результатам t-тестов, можно с уверенностью утверждать, что есть существенные различия в среднем росте и весе между мужчинами и женщинами.

# 3. Корреляция между ростом и весом:
# Для мужчин: корреляция между ростом и весом = 0.863. Это довольно высокая положительная корреляция, что говорит о том, что рост и вес у мужчин сильно взаимосвязаны — если мужчина выше, то, скорее всего, и его вес будет выше.
# Для женщин: корреляция между ростом и весом = 0.850. Корреляция также высокая, что означает, что рост и вес у женщин тоже сильно взаимосвязаны.
# Вывод: В обоих случаях существует сильная положительная зависимость между ростом и весом, как для мужчин, так и для женщин. Это подтверждает, что рост является важным фактором, влияющим на вес.

# Визуализация:
# Бокс-плоты помогут вам наглядно увидеть различия в распределениях роста и веса между мужчинами и женщинами, а также наличие выбросов.
# Точечная диаграмма (scatter plot) для роста и веса покажет взаимосвязь между этими переменными для обеих групп.
# Заключение:
# Данные о росте и весе нормально распределены.
# Средние значения роста и веса значительно различаются между мужчинами и женщинами.
# Рост и вес взаимосвязаны в обеих группах, и эта зависимость достаточно сильная.
# Это предоставляет полезную информацию, которая может быть использована для дальнейших анализов или построения предсказательных моделей, если понадобится.
